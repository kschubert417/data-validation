<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Manage Files</title>
  </head>
  <style>
    table,
    th,
    td {
      border: 1px solid black;
    }
  </style>
  <body>
    <h1>Manage Files</h1>
    <table>
      <tr>
        <th>File</th>
        <th>Table Name</th>
        <th>Setting</th>
      </tr>
      {% for file in files %}
      <tr>
        <td>{{ file }}</td>
        <td>
          <select class="tableSelect" onchange="updateLink(this)">
            <option file="{{ file }}" value="" selected disabled hidden>
              Choose Table
            </option>
            <option file="{{ file }}" value="MASTERFILE">masterfile</option>
            <option file="{{ file }}" value="PRODFAM">prodfam</option>
          </select>
        </td>
        <td>
          <a href="/forms?file={{ file }}" class="settings-link">Settings</a>
        </td>
      </tr>
      {% endfor %}
    </table>
    <script>
      function updateLink(selectElement) {
        const table = selectElement.value;
        const link = selectElement
          .closest("tr")
          .querySelector(".settings-link");
        const url = new URL(link.href);

        // Remove existing 'table' query parameter if present
        url.searchParams.delete("table");
        // Add new 'table' parameter
        url.searchParams.append("table", table);
        link.href = url.toString();
        console.log(link.href);
      }
    </script>
  </body>
</html>
